/** laydateTab v1.0 MIT License 多个laydate选择框, 依赖laydate @Author：xumi */
!function(){var o=window.layui&&layui.define,j={getPath:function(){var u=document.currentScript?document.currentScript.src:function(){var x=document.scripts,w=x.length-1,y;for(var v=w;v>0;v--){if(x[v].readyState==="interactive"){y=x[v].src;break}}return y||x[w].src}();return u.substring(0,u.lastIndexOf("/")+1)}(),getStyle:function(w,u){var v=w.currentStyle?w.currentStyle:window.getComputedStyle(w,null);return v[v.getPropertyValue?"getPropertyValue":"getAttribute"](u)},link:function(u,B,v){if(!m.path){return}var C=document.getElementsByTagName("head")[0],A=document.createElement("link");if(typeof B==="string"){v=B}var x=(v||u).replace(/\.|\//g,"");var w="layuicss-"+x,z=0;A.rel="stylesheet";A.href=m.path+u;A.id=w;if(!document.getElementById(w)){C.appendChild(A)}if(typeof B!=="function"){return}(function y(){if(++z>8*1000/100){return window.console&&console.error(w+".css: Invalid")}parseInt(j.getStyle(document.getElementById(w),"width"))===1989?B():setTimeout(y,100)}())}};var a,h,m={v:"1.0",config:{},path:j.getPath,ready:function(v){a=window.lay;h=h?h:(o?layui.laydate:window.laydate);var u="laydateTab",w="css/laydateTab.css?v="+m.v;j.link(w,v,u);return this},link:function(w,v,u){j.link(w,v,u)}},f="laydateTab",t=0,s="laydate-tab",r="laydate-tab-title",c="laydate-tab-panl",d="selected",n=".laydate-tab>ul>li.selected",b="yyyy|y|MM|M|dd|d|HH|H|mm|m|ss|s",k={year:/(M{1,2}|d{1,2}|H{1,2}|m{1,2}|s{1,2})[^y]/g,month:/(d{1,2}|H{1,2}|m{1,2}|s{1,2})[^M]/g,date:/(H{1,2}|m{1,2}|s{1,2})[^d]/g,time:/(y{2,4}|M{1,2}|d{1,2})[^H]/g},q={year:"yyyy",month:"yyyy-MM",date:"yyyy-MM-dd",time:"HH:mm:ss",datetime:"yyyy-MM-dd HH:mm:ss"},e={ymd:["year","month","date"],ym:["year","month"],md:["month","date"],all:["year","month","date","time","datetime"]},g={year:"年",month:"月",date:"日期",datetime:"日期时间",time:"时间"},l=function(u){return u.constructor===Array?u:[u]},i=function(u,v){return typeof u[v]!=="undefined"?u[v]:u[0]},p=function(u){if(!h){console.error("没有找到layui中laydate组件，无法进行渲染！");return}if(!u.elem){console.error("没有绑定相关的触发元素！");return}this.config=this.getDefualtConfig();for(var v in this.config){if(u[v]&&this.config[v].constructor===Array){delete this.config[v]}}this.config=a.extend({},this.config,u);u.btns&&(this.config.btns=typeof u.btns[0]==="string"?[u.btns]:u.btns);this.elem=a(u.elem);this._id=f+t++;if(/^#/.test(u.theme)){var w=a.elem("style"),x="#"+this._id+n+"{background: "+u.theme+"}";if("styleSheet" in w){w.setAttribute("type","text/css");w.styleSheet.cssText=x}else{w.innerHTML=x}a("body").append(w)}typeof u.value==="string"&&(this.val(u.value),delete this.config.value);this.bindEvent()};p.prototype.getDefualtConfig=function(){return{trigger:"click",type:e.ymd}};p.prototype.render=function(){this.creteTab()};p.prototype.creteTab=function(){var u=this.config,A=this.elem,O=a(a.elem("div",{"class":s,id:this._id})),N=this.titleElem=a(a.elem("ul",{"class":r})),B=this.panlElem=a(a.elem("div",{"class":c})),D=this.types=this.getTypes(u.type),I=D.length,M=this.isInput(A[0])?A[0].value:A[0].innerHTML,z=u.selected?u.selected:D[0],z=g[z]?z:D[0],H=null;this.tabElem=O;delete u.type;this.laydateObj=[];this.laydateOptions=[];for(var K=0;K<I;K++){var G={},v=G.type=D[K],C=v===z?{"class":d}:null,w=a(a.elem("li",C)),E=a.elem("div",C);w[0].index=K;for(var P in u){var J=u[P],J=l(J),F=i(J,K);F&&(G[P]=F)}w.html(G.title?G.title:g[v]);G.done=this.doneFn(G.done);G.position="static";G.elem=E;var y=k[v],x=M||G.value,L=G.format;G.format=(L?(y?L.replace(y,""):L):q[v]).replace(/\s$/,"");if(x&&this.isInitValue(G,x)){G.value=x;u.locationValueTab!==false&&(H=K)}this.laydateObj.push(h.render(G));N.append(w[0]);B.append(E);this.changeEvent(G,w)}u.valueToSelect;O.append(N[0]);O.append(B[0]);a("body").append(O[0]);O.on("click",function(Q){Q&&Q.stopPropagation?Q.stopPropagation():(Q.cancelBubble=true)});H!==null&&this.changeTab(H);this.position()};p.prototype.isInitValue=function(w,C){var y=this,A=w.format.match(new RegExp(b+"|.","g"))||[],u="",B=false;a.each(A,function(E,F){var D=F.length;u+=("("+(/y|M|d|H|m|s/.test(F)?"\\d{"+D+","+(D>2?4:2)+"}":F)+")")});u=new RegExp("^"+u+"$");if(w.range){var v=" "+w.range+" ",z=C.split(v);C=z[0];var x=z[1];if(!u.test(x)){return false}}B=u.test(C);return B};p.prototype.getTypes=function(z){if(this.types){return this.types}var v=typeof z==="string"?e[z]||[z]:z,y={},x=[];for(var w=0,u=v.length;w<u;w++){!y[v[w]]&&(y[v[w]]=true)&&x.push(v[w])}return x};p.prototype.doneFn=function(u){var v=this;return function(x,w,y){v.value=x;if(typeof u==="function"){v.value=u(x,w,y)||x}v.val(v.value);v.remove()}};p.prototype.val=function(v){var u=this.isInput(this.elem[0])?"val":"html";this.elem[u](v)};p.prototype.isInput=function(u){return/input|textarea/.test(u.tagName.toLocaleLowerCase())};p.prototype.changeEvent=function(x,u){var w=x.changeTab,v=x.type,y=this;u.on("click",function(){if(!a(this).hasClass(d)){y.changeTab(this.index,w,v)}})};p.prototype.changeTab=function(B,D,C){var w=this.titleElem[0],z=this.panlElem[0],y=z.childNodes,v=w.childNodes;for(var x=0,A=v.length;x<A;x++){var u=x===B?"addClass":"removeClass";a(v[x])[u](d);a(y[x])[u](d)}typeof D==="function"&&D(C,v[B].innerHTML)};p.prototype.bindEvent=function(){var u=this.config,w=this.elem,v=this;w.on(u.trigger,function(x,y){if(v.tabElem){return}v.render()});a(document).on("click",function(x){if(!v.tabElem||x.target===w[0]||x.target===v.tabElem[0]){return}v.remove()});a(window).on("resize",function(x){v.position()});a(document).on("scroll",function(x){v.position()})};p.prototype.position=function(){var z=this,E=z.config,w=z.elem[0],D=z.tabElem[0],C=w.getBoundingClientRect(),y=D.offsetWidth,u=D.offsetHeight,A=function(F){return document.documentElement[F?"clientWidth":"clientHeight"]},x=5,v=C.left,B=C.bottom;if(v+y+x>A("width")){v=A("width")-y-x}if(B+u+x>A()){B=C.top>u?C.top-u:A()-u;B=B}D.style.left=v+"px";D.style.top=B+"px";typeof E.success==="function"&&E.success(D,E)};p.prototype.remove=function(v){var u=this.config;if(this.tabElem){this.tabElem.remove();this.tabElem=null;typeof u.end==="function"&&u.end(this.elem[0])}};m.render=function(v){var u=new p(v);return{config:u.config}};m.ready();o?(layui.define("laydate",function(u){a=window.lay;h=layui.laydate;m.path=layui.cache.dir;u(f,m)})):((typeof define==="function"&&define.amd)?define(function(){return m}):function(){window.laydateTab=m}())}();